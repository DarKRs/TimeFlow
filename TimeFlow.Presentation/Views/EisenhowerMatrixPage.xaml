<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:import="clr-namespace:Custom.MAUI.Components;assembly=Custom.MAUI.Components" 
             x:Class="TimeFlow.Presentation.Views.EisenhowerMatrixPage"
             Title="Матрица Эйзенхауэра">

    <Grid ColumnDefinitions="*,*">

        <!-- Левая часть: Календарь -->
        <Grid Padding="10" Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Label Text="Календарь" FontAttributes="Bold" FontSize="20" HorizontalOptions="Center" Margin="0,0,0,10"/>

            <import:CustomCalendar x:Name="MyCalendar" />

            <StackLayout x:Name="TaskEditor" IsVisible="{Binding IsTaskEditorVisible}" Grid.Row="1" VerticalOptions="End" Margin="0, 5, 0, 0">
                <!-- Заголовок задачи -->
                <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand" Margin="0, 5, 0, 10">
                    <Label Text="Создать задачу" FontAttributes="Bold" FontSize="20" VerticalOptions="Center" />
                    <Label Text="{Binding DisplayedDateText}" FontAttributes="Italic" HorizontalOptions="EndAndExpand" VerticalOptions="Center" />
                </StackLayout>

                <Entry Placeholder="Название задачи" Text="{Binding TaskTitle}" Margin="0, 5" />
                <Editor Placeholder="Описание задачи" Text="{Binding TaskDescription}" HeightRequest="80" Margin="0, 5" />

                <StackLayout Orientation="Horizontal" Spacing="15" Margin="0, 5" HorizontalOptions="Fill">
                    <HorizontalStackLayout Spacing="15">
                        <!-- Важная задача -->
                        <HorizontalStackLayout Spacing="5">
                            <CheckBox IsChecked="{Binding IsImportant}" 
                                      Scale="0.8" 
                                      WidthRequest="20" 
                                      HeightRequest="20" 
                                      VerticalOptions="Center"/>
                            <Label Text="Важная" VerticalOptions="Center" FontSize="14"/>
                        </HorizontalStackLayout>

                        <!-- Срочная задача -->
                        <HorizontalStackLayout Spacing="5">
                            <CheckBox IsChecked="{Binding IsUrgent}" 
                                      Scale="0.8" 
                                      WidthRequest="20" 
                                      HeightRequest="20" 
                                      VerticalOptions="Center"/>
                            <Label Text="Срочная" VerticalOptions="Center" FontSize="14"/>
                        </HorizontalStackLayout>
                    </HorizontalStackLayout>

                    <!-- Правый блок с вводом времени -->
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="EndAndExpand">
                        <HorizontalStackLayout Spacing="5">
                            <Label Text="Время начала" VerticalOptions="Center" />
                            <import:CustomTimePicker SelectedTime="{Binding PlannedStartTime, Mode=TwoWay}" CustomWidth="110" CustomHeight="30" TimeFormat="HH:mm" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="5">
                            <Label Text="Время на задачу" VerticalOptions="Center" FontSize="14" />
                            <import:CustomTimePicker SelectedTime="{Binding EstimatedDuration, Mode=TwoWay}" CustomWidth="110" CustomHeight="30" TimeFormat="HH:mm" />
                        </HorizontalStackLayout>
                    </HorizontalStackLayout>
                </StackLayout>


                <!-- Кнопки -->
                <StackLayout Orientation="Horizontal" Spacing="10" Margin="0, 10" HorizontalOptions="Start">
                    <Button Text="Сохранить" Command="{Binding SaveTaskCommand}" WidthRequest="100" />
                    <Button Text="Отмена" Command="{Binding CancelEditCommand}" WidthRequest="100" />
                </StackLayout>
            </StackLayout>

        </Grid>

        <!-- Правая часть: Канбан-доска задач на неделю -->
        <ScrollView Orientation="Vertical" Grid.Column="1">
            <StackLayout Padding="15" Spacing="10">
                <Label Text="Задачи на Неделю" FontAttributes="Bold" FontSize="22" HorizontalOptions="Center" TextColor="#1A5276" Margin="0,5,0,10"/>

                <!-- Пример строки для Понедельника -->
                <StackLayout Padding="5">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand" VerticalOptions="Start" Margin="0,0,0,5">
                        <Label Text="Понедельник" FontAttributes="Bold" FontSize="18" TextColor="#2E86C1" VerticalOptions="Center"/>
                        <Label Text="{Binding MondayDate, StringFormat=' {0:dd MMM yyyy}'}" FontSize="14" TextColor="#555" Margin="10,0,0,0" VerticalOptions="Center"/>
                    </StackLayout>
                    <ScrollView Orientation="Horizontal">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <CollectionView ItemsSource="{Binding MondayTasks}" ItemsLayout="HorizontalList" HeightRequest="130">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="White" CornerRadius="8" Padding="8" Margin="6"
                                       BorderColor="#D0D0D0" HasShadow="False" HeightRequest="120" WidthRequest="190">
                                            <StackLayout>
                                                <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="14" TextColor="#111"/>
                                                <Label Text="{Binding PlannedStart, StringFormat='{0:t}'} - {Binding PlannedEnd, StringFormat='{0:t}'}" 
                                               FontSize="12" TextColor="#777"/>
                                                <Label Text="{Binding Description}" FontSize="12" TextColor="#333" Margin="0,5,0,0" 
                                               LineBreakMode="WordWrap" MaxLines="3"/>
                                            </StackLayout>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </ScrollView>
                </StackLayout>

                <!-- Повторите для других дней недели -->
            </StackLayout>
        </ScrollView>

    </Grid>
</ContentPage>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:Custom.MAUI.Calendar;assembly=Custom.MAUI.Calendar" 
             x:Class="TimeFlow.Presentation.Views.EisenhowerMatrixPage"
             Title="Матрица Эйзенхауэра">

    <Grid ColumnDefinitions="2*,3*">

        <!-- Левая часть: Календарь -->
        <Grid Padding="10" Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Label Text="Календарь" FontAttributes="Bold" FontSize="20" HorizontalOptions="Center" Margin="0,0,0,10"/>

            <controls:CustomCalendar x:Name="MyCalendar" />



            <StackLayout x:Name="TaskEditor" IsVisible="{Binding IsTaskEditorVisible}" Grid.Row="1" VerticalOptions="End" Margin="0, 10, 0, 0">
                <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand" Margin="0, 5, 0, 10">
                    <Label Text="Создать задачу" FontAttributes="Bold" FontSize="20" VerticalOptions="Center" />
                    <Label Text="{Binding SelectedDate, StringFormat='Дата: {0:dd MMMM yyyy}'}" FontAttributes="Italic" HorizontalOptions="EndAndExpand" VerticalOptions="Center" />
                </StackLayout>
                <Entry Placeholder="Название задачи" Text="{Binding TaskTitle}" Margin="0, 5" />
                <Editor Placeholder="Описание задачи" Text="{Binding TaskDescription}" HeightRequest="80" Margin="0, 5" />
                <StackLayout Orientation="Horizontal" Spacing="20" Margin="0, 5">
                    <StackLayout Orientation="Horizontal" VerticalOptions="Center">
                        <CheckBox IsChecked="{Binding IsImportant}" HorizontalOptions="Center" />
                        <Label Text="Важная" VerticalOptions="Center" Margin="2,0,0,0" />
                    </StackLayout>
                    <StackLayout Orientation="Horizontal" VerticalOptions="Center">
                        <CheckBox IsChecked="{Binding IsUrgent}" HorizontalOptions="Center" />
                        <Label Text="Срочная" VerticalOptions="Center" Margin="2,0,0,0" />
                    </StackLayout>
                </StackLayout>
                <StackLayout Orientation="Horizontal" Spacing="10" Margin="0, 10" HorizontalOptions="Start">
                    <Button Text="Сохранить" Command="{Binding SaveTaskCommand}" WidthRequest="100" />
                    <Button Text="Отмена" Command="{Binding CancelEditCommand}" WidthRequest="100" />
                </StackLayout>
            </StackLayout>


        </Grid>

        <!-- Правая часть: Канбан-доска задач на неделю -->
        <StackLayout Grid.Column="1" Padding="10">
            <Label Text="Задачи на Неделю" FontAttributes="Bold" FontSize="20" HorizontalOptions="Center" Margin="0,0,0,10"/>


            <Grid ColumnDefinitions="*,*,*,*,*,*,*">

                <!-- Понедельник -->
                <StackLayout Grid.Column="0" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Monday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Понедельник" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding MondayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                    </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Вторник -->
                <StackLayout Grid.Column="1" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Tuesday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Вторник" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding TuesdayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Среда -->
                <StackLayout Grid.Column="2" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Wednesday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Среда" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding WednesdayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Четверг -->
                <StackLayout Grid.Column="3" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Thursday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Четверг" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding ThursdayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Пятница -->
                <StackLayout Grid.Column="4" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Friday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Пятница" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding FridayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Суббота -->
                <StackLayout Grid.Column="5" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Saturday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Суббота" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding SaturdayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Воскресенье -->
                <StackLayout Grid.Column="6" BackgroundColor="#2B2B2B" Padding="5" Margin="2">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DayTappedCommand}" CommandParameter="Sunday" />
                    </StackLayout.GestureRecognizers>
                    <Label Text="Воскресенье" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                    <CollectionView ItemsSource="{Binding SundayTasks}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#D3D3D3" CornerRadius="5" Padding="5" Margin="5">
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding PlannedStart, StringFormat='{0:t} - {Binding PlannedEnd, StringFormat='{0:t}'}'}" FontSize="10" TextColor="Gray"/>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

            </Grid>
        </StackLayout>
    </Grid>
</ContentPage>